{
  "$schema":"http://json-schema.org/draft-07/schema#",
  "title":"fitpack_v2",
  "type":"object",
  "required":["version","material","dim","channels","materials_json","variables","targets","sim","loss","output_override_file"],
  "properties":{
    "version":{"const":2},
    "material":{"type":"string"},
    "dim":{"enum":["2D","3D"]},
    "channels":{"type":"array","items":{"type":"string"},"uniqueItems":true},
    "materials_json":{"type":"string"},
    "variables":{
      "type":"array",
      "minItems":1,
      "items":{"type":"object","required":["key","lo","hi","init"],
        "properties":{
          "key":{"type":"string","pattern":"^[a-zA-Z_][a-zA-Z0-9_]*(\\.([a-zA-Z_][a-zA-Z0-9_]*|\\[[0-9]+\\]))*$"},
          "lo":{"type":"number"},"hi":{"type":"number"},"init":{"type":"number"},
          "prior_mu":{"type":"number"},"prior_lambda":{"type":"number","minimum":0}
        }, 
        "additionalProperties":false}
    },
    "targets":{
      "type":"array",
      "minItems":1,
      "items":{"type":"object","required":["metric","T_K","value"],
        "properties":{
          "metric":{"enum":["T2star_ps","T1_ps"]},
          "T_K":{"type":"number","minimum":0.1,"maximum":1000},
          "value":{"type":"number","minimum":0},
          "weight":{"type":"number","minimum":0,"default":1.0},
          "sigma":{"type":"number","minimum":0}
        }, 
        "additionalProperties":false}
    },
    "sim":{"type":"object",
      "properties":{
        "max_modes":{"type":"integer","minimum":1,"maximum":20,"default":4},
        "use_gpu":{"type":"boolean","default":false},
        "n_max":{"type":"integer","minimum":2,"maximum":10,"default":3},
        "abs_tol":{"type":"number","minimum":1e-12,"maximum":1e-3,"default":1e-6},
        "rel_tol":{"type":"number","minimum":1e-12,"maximum":1e-3,"default":1e-5},
        "omp_threads":{"type":"integer","minimum":0,"maximum":64,"default":0},
        "val_split":{"type":"number","minimum":0,"maximum":0.5,"default":0.0}
      },
      "additionalProperties":false},
    "loss":{"type":"object","properties":{"type":{"enum":["huber_log","mse_log"],"default":"huber_log"},"delta":{"type":"number","minimum":0.01,"maximum":1.0,"default":0.1}}, "additionalProperties":false},
    "output_override_file":{"type":"string"},
    "checkpoint_file":{"type":"string"}
  },
  "additionalProperties":false
}